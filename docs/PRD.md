# 山富旅遊機票資料爬蟲系統 PRD 需求文件

## 一、專案背景與目標

本專案旨在開發一個自動化爬蟲系統，針對山富旅遊進行動態資料抓取，特別聚焦於機票價格及相關資訊。透過非同步處理技術，確保系統能高效地處理多組查詢任務，並將所得資料存儲至 BigQuery 以便後續分析。

## 二、功能需求

### 2.1 核心功能

1. **動態爬蟲功能**
   - 系統應能夠透過 requests 模擬使用者行為，以 GET 請求存取山富旅遊網站
   - 支援指定「航班編號」、「去程日期」、「回程日期」、「艙等」等參數進行查詢
   - 能夠使用 BeautifulSoup 正確解析回傳的 HTML 頁面，提取機票資料

2. **非同步任務處理**
   - 支援多任務並行執行，提高爬蟲效率
   - 系統應能在2小時內完成30組不同參數組合的抓取任務
   - 建立任務佇列機制，確保任務有序且可控地執行

3. **資料儲存與管理**
   - 將抓取的機票資料結構化後儲存至 BigQuery 、 cloud storage
   - 記錄每次爬蟲的執行狀態與結果

### 2.2 系統特性

1. **可靠性**
   - 具備錯誤重試機制，當爬蟲失敗時能自動重試
   - 防止被目標網站識別為機器人的防護措施

2. **可擴展性**
   - 系統架構應支援未來增加更多爬蟲目標或參數
   - 能夠根據任務量彈性調整資源分配

3. **監控與通知**
   - 提供任務執行狀態的即時監控
   - 當任務完成或出現異常時，發送通知

## 三、技術規格

1. **爬蟲技術**
   - 使用 requests 函式庫進行 GET 請求
   - 用 BeautifulSoup 函式庫解析 HTML。

2. **雲端部署**
   - 部署於 Google Cloud Run 環境
   - 利用容器化技術確保環境一致性

3. **資料庫技術**
   - 使用 Google BigQuery 作為資料儲存解決方案
   - 使用 Google Cloud Storage 作為資料儲存解決方案

4. **程式語言與框架**
   - 使用 Python 作為主要開發語言
   - 採用 asyncio 或類似框架處理非同步任務

## 四、使用者故事與驗收條件

### 故事一：基本爬蟲功能

**作為**系統管理員，**我希望**能夠指定航班編號、去程日期和回程日期、艙等來抓取機票資料，**以便**獲取特定航線的價格資訊。

**驗收條件：**
- 系統能接受「航班編號」、「去程日期」、「回程日期」、「艙等」作為輸入參數
- 成功抓取符合條件的機票資料，包括價格、航空公司、航班時間等資訊
- 資料以結構化方式存儲於 BigQuery

### 故事二：批次任務執行

**作為**系統管理員，**我希望**針對國定節日及指定日期區間，能夠批次提交多組查詢參數，**以便**同時監控多條航線的價格變化。

**驗收條件：**
- 系統能接受批次任務提交（最少30組參數組合）
- 批次任務能在2小時內完成處理
- 每組任務的執行狀態可被追蹤與監控

## 五、非功能需求

1. **效能需求**
   - 系統應能在2小時內完成100組參數組合的抓取任務
   - 單一任務的平均執行時間不應超過10分鐘

2. **可用性需求**
   - 系統正常運行時間(Uptime)應達到99%
   - 計劃性維護應提前通知

3. **安全性需求**
   - 存取 BigQuery 的憑證應妥善保管與權限控制

## 六、系統限制與假設

1. **限制**
   - 爬蟲速率受限於山富旅遊網站的反爬蟲機制
   - 爬蟲速率受限於可能的API限制，每10秒不得呼叫超過40次
   - Cloud Run 的資源限制可能影響並行任務數量

2. **假設**
   - 假設山富旅遊網站的API結構相對穩定
   - 假設有足夠的 BigQuery 配額處理資料存儲需求 
